<div x-data="{ open: false }" 
     x-show="open" 
     @keydown.escape.window="open = false"
     @toggle-modal.window="open = !open"
     class="fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6"
     style="display: none;" id="createServerModal">
  <% const clientSettings = (settings && settings.api && settings.api.client) ? settings.api.client : {}; %>
  <% const locations = clientSettings.locations || {}; %>
  <% const eggs = clientSettings.eggs || {}; %>

  <div class="absolute inset-0 bg-neutral-950/70 backdrop-blur-sm" @click="open = false"></div>
  <div class="relative w-full max-w-3xl rounded-md border border-neutral-800 bg-neutral-900/95 shadow-2xl ring-1 ring-black/40 modal-content">
    <div class="flex items-center justify-between border-b border-neutral-800/70 px-6 py-5">
      <div class="text-white">
        <h2 class="text-xl font-semibold tracking-tight">Create a new server</h2>
        <p class="text-sm text-slate-400 mt-1">Pick resources, location, and software. Limits apply to your plan.</p>
      </div>
      <button type="button" onclick="toggleModal()" class="rounded-full border border-neutral-800 bg-white/5 px-3 py-2 text-xs font-medium text-slate-200 hover:bg-white/10">
        Close
      </button>
    </div>
    <form>
      <div class="px-6 py-6 space-y-6">
        <div>
          <label class="block mb-2 text-sm font-medium text-white">Server name</label>
          <input type="text" id="InputName" class="w-full border border-neutral-800 bg-neutral-950 focus:ring-sky-500 focus:border-transparent font-medium pl-4 py-3 text-sm text-slate-300 placeholder:text-slate-500 tracking-tight rounded-sm" placeholder="e.g. Survival SMP" x-model="aiName">
          <p class="text-xs text-slate-500 mt-2">This is visible to you and anyone you share the server with.</p>
        </div>

        <div>
          <div class="flex items-center justify-between mb-2">
            <label class="text-sm font-medium text-white">Resources</label>
            <span class="text-xs text-slate-500">Numbers only</span>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div>
              <label class="block mb-2 text-xs font-medium text-slate-400">Memory (GB)</label>
              <input type="number" id="InputRAM" class="w-full border border-neutral-800 bg-neutral-950 focus:ring-sky-500 focus:border-transparent font-medium pl-4 py-3 text-sm text-slate-300 placeholder:text-slate-500 tracking-tight rounded-sm" placeholder="2">
            </div>
            <div>
              <label class="block mb-2 text-xs font-medium text-slate-400">Storage (GB)</label>
              <input type="number" id="InputDisk" class="w-full border border-neutral-800 bg-neutral-950 focus:ring-sky-500 focus:border-transparent font-medium pl-4 py-3 text-sm text-slate-300 placeholder:text-slate-500 tracking-tight rounded-sm" placeholder="10">
            </div>
            <div>
              <label class="block mb-2 text-xs font-medium text-slate-400">CPU Cores</label>
              <input type="number" id="InputCPU" class="w-full border border-neutral-800 bg-neutral-950 focus:ring-sky-500 focus:border-transparent font-medium pl-4 py-3 text-sm text-slate-300 placeholder:text-slate-500 tracking-tight rounded-sm" placeholder="1">
            </div>
          </div>
        </div>

        <div>
          <label class="block mb-2 text-sm font-medium text-white">Location</label>
          <p class="text-xs text-slate-500 mb-3">Choose the region closest to your players.</p>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
        <% for (let [name, value] of Object.entries(locations)) { %>
          <% if (value.show) { %>
            <div class="card location-card border border-neutral-800 bg-neutral-950/70 hover:bg-neutral-900/80 hover:border-sky-500/40 text-white pl-4 py-2.5 rounded-sm font-medium cursor-pointer transition"
                 data-name="<%= name %>" 
                 onclick="selectLocation('<%= name %>')">
              <img class="inline-flex w-5 h-6 mr-2 rounded-sm" style="margin-bottom: 3.25px;" src="https://flagsapi.com/<%= value.iso %>/flat/64.png" alt="Flag">
              <%= value.name %>
            </div>
          <% } %>
        <% } %>
        <input type="hidden" id="InputLoc">
          </div>
        </div>
      
        <div>
          <label class="block mb-2 text-sm font-medium text-white">Software</label>
          <select class="w-full border border-neutral-800 bg-neutral-950 focus:ring-sky-500 focus:border-transparent font-medium pl-4 py-3 text-sm text-slate-300 placeholder:text-slate-500 tracking-tight rounded-sm" id="InputEgg">
        <% for (let [name, value] of Object.entries(eggs)) { %>
          <% if (value.enabled === true) { %>
          <% if (!(value.adminOnly && (!pterodactyl || !pterodactyl.root_admin))) { %>
            <% if (value.pro) { %>
            <% if (packagename !== 'pro') { %>
            <% } else { %>
            <option class="" value="<%= name %>"><%= value.display %></option>
            <% } %>

            <% } else { %>
            <option class="" value="<%= name %>"><%= value.display %></option>
           <% } %>
          <% } %>
          <% } %>
        <% } %>
          </select>
        </div>
      </div>

      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 border-t border-neutral-800/70 px-6 py-5">
        <div x-data="{ open: false }" class="relative">
          <button @mouseenter="open = true" @mouseleave="open = false" type="button" class="inline-flex items-center rounded-full border border-neutral-800 bg-white/5 px-3 py-2 text-xs font-medium text-slate-300 hover:bg-white/10">
            Terms
          </button>
          <div x-show="open"
            class="absolute left-0 top-full mt-2 rounded-sm bg-neutral-950 border border-neutral-800 px-4 py-2.5 text-xs text-white font-medium tracking-tight"
            style="display: none;">
            By clicking Create, you agree to the <%= settings.name %> User Agreement and Minecraft EULA.
          </div>
        </div>
        <div class="flex items-center gap-3">
          <button type="button" onclick="toggleModal()" class="bg-transparent text-slate-400 hover:text-slate-200 font-medium py-2 px-4 rounded-sm">
            Cancel
          </button>
          <button type="button" onclick="submitNew()" class="bg-sky-500 text-white font-semibold py-2.5 px-5 rounded-sm border border-neutral-800 hover:bg-sky-400 transition-colors">
            Create Server
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<style>
/* Modal Content Container */
.modal-content {
  max-height: 80vh; /* 80% of the viewport height */
  overflow-y: auto; /* Enables scrolling */
}

@media (max-height: 500px) {
  .modal-content {
    max-height: 70vh; /* Smaller max-height for very small screens */
  }
}

.card-selected {
  border-color: #38bdf8;
  background-color: #0b1220;
  box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45);
}
</style>
