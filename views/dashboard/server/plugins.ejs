<%- include('../../components/head') %>

<body class="min-h-screen bg-neutral-950 text-slate-100">
  <%- include('../../components/modal') %>
  <div>
    <%- include('../../components/navigation') %>
    <div class="md:pl-64 flex flex-col flex-1 min-h-screen">
      <%- include('../../components/header') %>
      <main class="flex-1 pb-8">
        <div class="py-4 md:py-6">
          <%- include('../../components/skeleton') %>
          <div class="hidden max-w-screen-2xl mx-auto px-4 sm:px-6 md:px-8" id="content">
            <%- include('./header') %>
            <%- include('./tabs') %>

            <div class="grid grid-cols-1 xl:grid-cols-[1.6fr_1fr] gap-6 mt-6">
              <div class="bg-neutral-900/60 border border-neutral-800/80 rounded-2xl p-6 space-y-4">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Plugin manager</p>
                    <h2 class="text-xl font-semibold text-white mt-1">Keep your plugins tidy</h2>
                    <p class="text-sm text-slate-400 mt-1">Inspect the plugin folder, track what is installed, and keep your stack organized for this server.</p>
                  </div>
                  <div class="rounded-full bg-sky-500/10 border border-sky-500/30 px-3 py-1 text-[0.65rem] font-semibold uppercase tracking-[0.25em] text-sky-300">
                    Bukkit & Paper ready
                  </div>
                </div>

                <dl class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-slate-300">
                  <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 space-y-1">
                    <dt class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Plugin folder</dt>
                    <dd class="text-white font-semibold">/home/container/plugins</dd>
                    <dd class="text-xs text-slate-500">Use this path for SFTP or uploads.</dd>
                  </div>
                  <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 space-y-1">
                    <dt class="text-[0.65rem] uppercase tracking-[0.3em] text-slate-500">Panel target</dt>
                    <dd class="text-white font-semibold line-clamp-1">Server <%= server.attributes.identifier %></dd>
                    <dd class="text-xs text-slate-500">Open the panel to browse or restart after installs.</dd>
                  </div>
                </dl>

                <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 space-y-2 text-sm text-slate-300">
                  <p class="font-semibold text-white">Tips</p>
                  <ul class="list-disc list-inside space-y-1 text-slate-400">
                    <li>Restart after adding or removing plugins so changes take effect.</li>
                    <li>Keep backups before large updates to avoid corrupted worlds.</li>
                    <li>Use the console to watch for dependency errors during startup.</li>
                  </ul>
                </div>

                <div class="flex flex-wrap gap-3">
                  <a
                    href="<%= serverConsoleUrl %>/files?dir=%2Fplugins"
                    target="_blank"
                    rel="noreferrer"
                    class="inline-flex items-center justify-center rounded-2xl bg-sky-500/90 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-400 transition"
                  >
                    Open plugin folder
                  </a>
                  <a
                    href="<%= serverConsoleUrl %>"
                    target="_blank"
                    rel="noreferrer"
                    class="inline-flex items-center justify-center rounded-2xl border border-neutral-800/70 bg-neutral-900/70 px-4 py-2 text-sm font-semibold text-slate-200 hover:border-slate-500 transition"
                  >
                    Go to console
                  </a>
                  <button
                    type="button"
                    id="copy-plugin-path"
                    class="inline-flex items-center justify-center rounded-2xl border border-neutral-800/70 bg-white/5 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10 transition"
                  >
                    Copy plugin path
                  </button>
                </div>
              </div>

              <div class="bg-neutral-900/60 border border-neutral-800/80 rounded-2xl p-6 space-y-4">
                <div>
                  <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Installer</p>
                  <h2 class="text-xl font-semibold text-white mt-1">Install from a URL</h2>
                  <p class="text-sm text-slate-400 mt-1">Drop in a direct download link to fetch a JAR straight into the plugins folder.</p>
                </div>

                <div class="space-y-3">
                  <label class="block text-xs uppercase tracking-[0.3em] text-slate-500">
                    Plugin name
                    <input
                      id="plugin-name"
                      type="text"
                      value="CustomPlugin"
                      class="mt-1 w-full rounded-xl border border-neutral-800 bg-neutral-950 py-2 px-3 text-sm text-white focus:border-sky-500 focus:outline-none"
                      placeholder="Vault, LuckPerms, EssentialsX"
                    />
                  </label>
                  <label class="block text-xs uppercase tracking-[0.3em] text-slate-500">
                    Direct download URL
                    <input
                      id="plugin-url"
                      type="url"
                      class="mt-1 w-full rounded-xl border border-neutral-800 bg-neutral-950 py-2 px-3 text-sm text-white focus:border-sky-500 focus:outline-none"
                      placeholder="https://example.com/plugin.jar"
                    />
                  </label>
                </div>

                <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 text-sm text-slate-300">
                  <p class="font-semibold text-white mb-1">What the command does</p>
                  <p class="text-slate-400">It changes to /home/container, makes sure plugins/ exists, and curls the JAR into that folder. Copy it and paste into the panel console.</p>
                </div>

                <div class="flex flex-wrap gap-3">
                  <button
                    type="button"
                    id="copy-install-command"
                    class="inline-flex items-center justify-center rounded-2xl bg-sky-500/90 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-400 transition"
                  >
                    Copy install command
                  </button>
                  <button
                    type="button"
                    id="open-console-after-copy"
                    class="inline-flex items-center justify-center rounded-2xl border border-neutral-800/70 bg-neutral-900/70 px-4 py-2 text-sm font-semibold text-slate-200 hover:border-slate-500 transition"
                    onclick="window.open('<%= serverConsoleUrl %>', '_blank')"
                  >
                    Open console
                  </button>
                </div>
              </div>
            </div>

            <div class="mt-6 bg-neutral-900/60 border border-neutral-800/80 rounded-2xl p-6 space-y-4">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div>
                  <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Starter plugins</p>
                  <h2 class="text-xl font-semibold text-white">Popular picks to drop in</h2>
                  <p class="text-sm text-slate-400">Copy an install command and paste it into the panel console to fetch the latest build.</p>
                </div>
                <div class="rounded-full bg-white/5 border border-neutral-800 px-3 py-1 text-xs text-slate-300">
                  Make sure links point to the right edition (Spigot/Paper).
                </div>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 space-y-2">
                  <div class="flex items-start justify-between gap-2">
                    <div>
                      <p class="text-sm font-semibold text-white">LuckPerms</p>
                      <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Permissions</p>
                    </div>
                    <button
                      type="button"
                      class="px-3 py-1 rounded-xl bg-sky-500/80 text-xs font-semibold text-white hover:bg-sky-400 transition"
                      data-plugin-name="LuckPerms"
                      data-plugin-url="https://download.luckperms.net/latest/bukkit"
                    >
                      Copy command
                    </button>
                  </div>
                  <p class="text-sm text-slate-400">Granular permission manager with context support and easy editor links.</p>
                </div>

                <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 space-y-2">
                  <div class="flex items-start justify-between gap-2">
                    <div>
                      <p class="text-sm font-semibold text-white">EssentialsX</p>
                      <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Quality of life</p>
                    </div>
                    <button
                      type="button"
                      class="px-3 py-1 rounded-xl bg-sky-500/80 text-xs font-semibold text-white hover:bg-sky-400 transition"
                      data-plugin-name="EssentialsX"
                      data-plugin-url="https://github.com/EssentialsX/Essentials/releases/latest/download/EssentialsX.jar"
                    >
                      Copy command
                    </button>
                  </div>
                  <p class="text-sm text-slate-400">Core commands, spawn, homes, kits, and chat tools ready for survival servers.</p>
                </div>

                <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 space-y-2">
                  <div class="flex items-start justify-between gap-2">
                    <div>
                      <p class="text-sm font-semibold text-white">Vault</p>
                      <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Economy bridge</p>
                    </div>
                    <button
                      type="button"
                      class="px-3 py-1 rounded-xl bg-sky-500/80 text-xs font-semibold text-white hover:bg-sky-400 transition"
                      data-plugin-name="Vault"
                      data-plugin-url="https://github.com/MilkBowl/Vault/releases/latest/download/Vault.jar"
                    >
                      Copy command
                    </button>
                  </div>
                  <p class="text-sm text-slate-400">Hooks economy and permission providers together so most plugins cooperate.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <%- include('../../components/footer') %>
    </div>
  </div>
  <%- include('../../components/notifications') %>

  <script>
    (() => {
      const pluginPath = "/home/container/plugins";

      function sanitizeName(name) {
        const clean = (name || "").trim().replace(/[^a-z0-9._-]+/gi, "");
        return clean || "plugin";
      }

      function buildCommand(name, url) {
        const safeName = sanitizeName(name);
        const targetName = safeName.toLowerCase().endsWith(".jar") ? safeName : `${safeName}.jar`;
        return `cd /home/container && mkdir -p plugins && curl -L "${url}" -o plugins/${targetName}`;
      }

      function notify(message, type = "info") {
        if (window.showNotification) {
          window.showNotification(message, type);
        } else {
          alert(message);
        }
      }

      async function copyText(value, successMessage) {
        try {
          await navigator.clipboard.writeText(value);
          notify(successMessage, "success");
        } catch (err) {
          notify("Unable to copy to clipboard in this browser. Copy it manually instead.", "warning");
          console.warn("Clipboard copy failed", err);
        }
      }

      const pathButton = document.getElementById("copy-plugin-path");
      if (pathButton) {
        pathButton.addEventListener("click", () => {
          copyText(pluginPath, "Plugin path copied");
        });
      }

      const installButton = document.getElementById("copy-install-command");
      if (installButton) {
        installButton.addEventListener("click", () => {
          const name = document.getElementById("plugin-name").value;
          const url = document.getElementById("plugin-url").value.trim();

          if (!url) {
            notify("Add a direct download link before copying the command.", "error");
            return;
          }

          const command = buildCommand(name, url);
          copyText(command, "Install command copied");
        });
      }

      document.querySelectorAll("[data-plugin-url]").forEach((button) => {
        button.addEventListener("click", () => {
          const name = button.getAttribute("data-plugin-name") || "plugin";
          const url = button.getAttribute("data-plugin-url");
          const command = buildCommand(name, url);
          copyText(command, `${name} install command copied`);
        });
      });
    })();
  </script>
</body>
