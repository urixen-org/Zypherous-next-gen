<%- include('../../components/head') %>

<body class="min-h-screen bg-neutral-950 text-slate-100">
  <%- include('../../components/modal') %>
  <div>
    <%- include('../../components/navigation') %>
    <div class="md:pl-64 flex flex-col flex-1 min-h-screen">
      <%- include('../../components/header') %>
      <main class="flex-1 pb-8">
        <div class="py-4 md:py-6">
          <%- include('../../components/skeleton') %>
          <div class="hidden max-w-screen-2xl mx-auto px-4 sm:px-6 md:px-8" id="content">
            <%- include('./header') %>
            <%- include('./tabs') %>

            <div class="mt-6 bg-neutral-900/60 border border-neutral-800/80 rounded-2xl p-6 space-y-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Network</p>
                  <h2 class="text-xl font-semibold text-white">Allocations</h2>
                </div>
                <span class="text-xs text-slate-500"><%= server.relationships && server.relationships.allocations && server.relationships.allocations.data ? server.relationships.allocations.data.length : 0 %> entries</span>
              </div>

              <% const allocations = server.relationships && server.relationships.allocations && server.relationships.allocations.data ? server.relationships.allocations.data : []; %>

              <% if (allocations.length === 0) { %>
                <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-6 text-sm text-slate-400">
                  No allocations were returned for this server. The Panel will show the current public IPs and ports.
                </div>
              <% } else { %>
                <div class="overflow-x-auto rounded-2xl border border-neutral-800/70">
                  <table class="min-w-full text-sm text-left">
                    <thead class="bg-neutral-950/70 text-xs uppercase tracking-[0.3em] text-slate-500">
                      <tr>
                        <th class="px-4 py-3">Address</th>
                        <th class="px-4 py-3">Port</th>
                        <th class="px-4 py-3">Default</th>
                        <th class="px-4 py-3">Proxy</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% allocations.forEach(function (allocation) { %>
                        <tr class="border-t border-neutral-800/70 bg-neutral-950/40">
                          <td class="px-4 py-3 font-semibold text-white"><%= allocation.attributes.ip %></td>
                          <td class="px-4 py-3 text-slate-300"><%= allocation.attributes.port %></td>
                          <td class="px-4 py-3">
                            <span class="<%= allocation.attributes.is_default ? 'text-sky-400' : 'text-slate-500' %>">
                              <%= allocation.attributes.is_default ? 'Primary' : 'Secondary' %>
                            </span>
                          </td>
                          <td class="px-4 py-3">
                            <span class="text-xs rounded-full px-2 py-1 <%= allocation.attributes.is_default ? 'bg-sky-500/10 text-sky-300 border border-sky-500/30' : 'bg-neutral-900 border border-neutral-800 text-slate-300' %>">
                              <%= allocation.attributes.node ? allocation.attributes.node : 'Dedicated' %>
                            </span>
                          </td>
                        </tr>
                      <% }) %>
                    </tbody>
                  </table>
                </div>
              <% } %>

              <p class="text-xs text-slate-500">
                Edit allocations or add IPs on the Panel. This dashboard only displays the current binding for quick reference.
              </p>
              <a
                href="<%= serverConsoleUrl %>/network"
                target="_blank"
                rel="noreferrer"
                class="inline-flex items-center justify-center rounded-2xl bg-sky-500/90 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-400 transition"
              >
                Open panel networking
              </a>
            </div>
          </div>
        </div>
      </main>
      <%- include('../../components/footer') %>
    </div>
  </div>
  <%- include('../../components/notifications') %>
</body>
