<%- include('../../components/head') %>

<body class="min-h-screen bg-neutral-950 text-slate-100">
  <%- include('../../components/modal') %>
  <div>
    <%- include('../../components/navigation') %>
    <div class="md:pl-64 flex flex-col flex-1 min-h-screen">
      <%- include('../../components/header') %>
      <main class="flex-1 pb-8">
        <div class="py-4 md:py-6">
          <%- include('../../components/skeleton') %>
          <div class="hidden max-w-screen-2xl mx-auto px-4 sm:px-6 md:px-8" id="content">
            <%- include('./header') %>
            <%- include('./tabs') %>

            <div class="mt-6 bg-neutral-900/60 border border-neutral-800/80 rounded-2xl p-6 space-y-6">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs uppercase tracking-[0.3em] text-slate-500">Schedules</p>
                  <h2 class="text-xl font-semibold text-white">Automations</h2>
                </div>
                <span class="text-xs text-slate-500">
                  Limit: <%= server.attributes.feature_limits && server.attributes.feature_limits.schedules ? server.attributes.feature_limits.schedules : "Unlimited" %>
                </span>
              </div>

              <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 space-y-3 text-sm text-slate-300">
                <% if (server.relationships && server.relationships.schedules && server.relationships.schedules.data && server.relationships.schedules.data.length) { %>
                  <% server.relationships.schedules.data.forEach(function (schedule) { %>
                    <div class="border-b border-neutral-800 pb-3 last:border-none">
                      <div class="flex items-center justify-between">
                        <span class="font-semibold text-white"><%= schedule.attributes.name %></span>
                        <span class="text-xs text-slate-500">Next run: <%= schedule.attributes.next_run || "TBD" %></span>
                      </div>
                      <p class="text-xs text-slate-400 mt-1">Task: <%= schedule.attributes.action ?? "Unknown" %></p>
                    </div>
                  <% }) %>
                <% } else { %>
                  <p>Schedules are managed in the panel. No scheduled tasks were returned for this server.</p>
                <% } %>
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 space-y-2 text-sm text-slate-300">
                  <p>
                    Scheduled backups, restarts, and custom actions are orchestrated through the Panel. Use the button below to open the schedule editor.
                  </p>
                </div>
                <div class="rounded-2xl bg-neutral-950/70 border border-neutral-800/70 p-4 text-sm text-slate-300">
                  <p>
                    You are granted up to <span class="text-white font-semibold"><%= server.attributes.feature_limits && server.attributes.feature_limits.schedules ? server.attributes.feature_limits.schedules : "unlimited" %></span> actions.
                  </p>
                </div>
              </div>

              <a
                href="<%= serverConsoleUrl %>/schedules"
                target="_blank"
                rel="noreferrer"
                class="inline-flex items-center justify-center rounded-2xl bg-sky-500/90 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-400 transition"
              >
                Open panel schedules
              </a>
            </div>
          </div>
        </div>
      </main>
      <%- include('../../components/footer') %>
    </div>
  </div>
  <%- include('../../components/notifications') %>
</body>
